name: Dotnet Core 6 Web API CI/CD Pipeline

on:
  push:
    branches:
      - master

jobs:
  build-and-publish:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '6.0.x'

    - name: Restore NuGet packages
      run: dotnet restore

    - name: Build and publish API
      run: |
        dotnet publish -c Release -o $(Build.ArtifactStagingDirectory)
        $env:APPLICATION_NAME = "denemejenkins"
        $env:ENVIRONMENT_NAME = "Production"
        $env:PUBLISH_PATH = "$(Build.ArtifactStagingDirectory)/$(env:APPLICATION_NAME)"
        $env:DESTINATION_PATH = "C:/inetpub/wwwroot/$(env:APPLICATION_NAME)"
        Copy-Item -Path $env:PUBLISH_PATH -Destination $env:DESTINATION_PATH -Recurse

      env:
        ASPNETCORE_ENVIRONMENT: production
